<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1"charset="UTF-8"/>
  <title>WPI Workday to iCal</title>
</head>
<body>
  <marquee>Web Design is my Passion</marquee>
  <h1>Upload Excel to generate iCal</h1>
  <input type="file" id="fileInput" />
  <pre id="output"></pre>

  <script src="static/wasm_exec.js"></script>
  <script>
      let wasmReady = false;
      const go = new Go();
      WebAssembly.instantiateStreaming(fetch("static/main.wasm"), go.importObject).then((result) => {
          go.run(result.instance);
          wasmReady = true;
      });


      const fileInput = document.getElementById("fileInput");
      const output = document.getElementById("output");

      fileInput.addEventListener("change", async (event) => {
        if (!wasmReady) {
          output.textContent = "WASM not ready yet.";
          return;
        }

        const file = event.target.files[0];
        if (!file) return;

        output.textContent = "Processing...";

        const arrayBuffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(arrayBuffer);

        try {
          const result = processFile(uint8Array);

          if (typeof result === "string") {
            output.textContent = "Error: " + result;
            return;
          }

          const blob = new Blob([result], { type: "text/calendar" });
          const url = URL.createObjectURL(blob);

          output.innerHTML = `
            <p>Download your iCal file here:</p>
            <a href="${url}" download="schedule.ics">Download iCal</a>
          `;
        } catch (e) {
          output.textContent = "Exception: " + e.message;
        }
      });
  </script>
</body>
</html>
